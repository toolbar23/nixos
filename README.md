# toolbar23 NixOS

Personal NixOS setup inspired by RGBCube/ncc with Hyprland, Quickshell (stub), home-manager, nixCats-nvim, and an automated installer ISO.

## Layout
- `flake.nix`: entry point using `nixpkgs-unstable`, home-manager, disko, lanzaboote, nixCats-nvim.
- `machines/lenovo.nix`, `machines/squid.nix`: host profiles (UEFI+Secure Boot, LUKS→Btrfs, AMD GPU).
- `modules/`: reusable pieces (nix/locale/users, hardware, desktop, services, dev tooling, home).
- `iso/installer.nix`: custom installer ISO with Wi-Fi loop and disko-install flow.
- `local/generated.nix`: optional host-local overrides (generated by installer or manually).

## Build the installer ISO
```bash
nix build .#installerIso
```
Result is in `result/iso/`.

## Installer flow (ISO)
1) Boots to TTY1 and auto-runs a script.
2) Loop `nmtui` until online.
3) Clone config repo (default `https://github.com/toolbar23/nixos`).
4) Pick machine profile, set target disk, confirm wipe.
5) Prompt once for root/pm password (stored hashed in `/etc/nixos/secrets/pm.passwd` and copied into target).
6) Run `disko-install` with the chosen profile and disk.
7) On first boot, swapfile is created automatically; run `sudo nixos-rebuild switch` once to pick up resume_offset for hibernate.

## Post-install
- Autologin to Hyprland via greetd/tuigreet for user `pm`.
- Neovim comes from nixCats-nvim input.
- Core services: PipeWire, Bluetooth, CUPS + drivers, Ghostty, Chromium, JetBrains Mono, starship for bash.

## Notes
- Secure Boot uses lanzaboote (self-signed keys in `/etc/secureboot`).
- Swapfile size = max(64 GiB, RAM size). Resume offset is written to `/etc/nixos/secrets/resume_offset` after first boot; rebuild once to apply it to the kernel cmdline.
- Quickshell package is installed; drop your QML config under `~/.config/quickshell/` and start it from Hyprland exec-once when ready. 
